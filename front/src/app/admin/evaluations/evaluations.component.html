<!-- src/app/components/evaluations/evaluations.component.html -->

<div class="container mt-4">
  <h2>{{ isEditing ? 'Modifier l\'Évaluation' : 'Ajouter une Évaluation' }}</h2>

  <form *ngIf="evaluationForm" [formGroup]="evaluationForm" (ngSubmit)="onSubmit()">
    <div class="row">
      <div class="col-md-6 mb-2">
        <label for="dateEvaluation">Date d'évaluation</label>
        <input type="date" id="dateEvaluation" class="form-control" formControlName="dateEvaluation">
      </div>
      <div class="col-md-6 mb-2">
        <label for="typeEvaluation">Type d'évaluation</label>
        <input type="text" id="typeEvaluation" class="form-control" formControlName="typeEvaluation" placeholder="Ex: QCM, Projet...">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-2">
        <label for="duree">Note </label>
        <input type="number" id="duree" class="form-control" formControlName="duree">
        <div *ngIf="evaluationForm.get('duree')?.invalid && evaluationForm.get('duree')?.touched" class="text-danger small mt-1">
          Ce champ est requis.
        </div>
      </div>
      <div class="col-md-6 mb-2">
        <label for="moduleId">Module</label>
        <select id="moduleId" class="form-select" formControlName="moduleId">
          <option value="" disabled>Sélectionnez un module</option>
          <option *ngFor="let m of modules" [value]="m.id">{{ m.titre }}</option>
        </select>
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-success" [disabled]="evaluationForm.invalid">
      Submit
    </button>
      <button type="button" class="btn btn-secondary ms-2" *ngIf="isEditing" (click)="resetForm()">
        Annuler
      </button>
    </div>
  </form>

  <hr class="my-4">

  <!-- Liste des évaluations -->
  <h3>Liste des Évaluations</h3>
  <table class="table table-bordered table-striped mt-3">
    <thead>
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Type</th>
        <th>Note</th>
        <th>Module</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let evaluation of evaluations">
        <td>{{ evaluation.id }}</td>
        <td>{{ evaluation.dateEvaluation | date: 'dd/MM/yyyy' }}</td>
        <td>{{ evaluation.typeEvaluation }}</td>
        <td>{{ evaluation.duree }}</td>
        <td>{{ evaluation.module?.titre || 'N/A' }}</td>
        <td>
          <button class="btn btn-warning btn-sm me-2" (click)="editEvaluation(evaluation)" title="Modifier">
            <i class="bi bi-pencil-fill"></i>
          </button>
          <button class="btn btn-danger btn-sm" (click)="deleteEvaluation(evaluation.id!)" title="Supprimer">
            <i class="bi bi-trash-fill"></i>
          </button>
        </td>
      </tr>
      <tr *ngIf="!evaluations || evaluations.length === 0">
        <td colspan="6" class="text-center">Aucune évaluation trouvée.</td>
      </tr>
    </tbody>
  </table>
</div>
